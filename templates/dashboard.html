<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Whatspy Dashboard</title>
  <style>
    body { font-family: system-ui, -apple-system, Arial, sans-serif; padding: 24px; color:#111; }
    h1 { margin: 0 0 16px; }
    code { background: #f4f4f4; padding: 2px 6px; border-radius: 4px; }
    .grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    .card { padding:16px; background:#fff; border:1px solid #e5e7eb; border-radius:10px; box-shadow: 0 1px 2px rgba(0,0,0,.04);}
    .muted { color:#6b7280; }
    ul { margin: 8px 0 0 18px; }
    .kv p { margin: 6px 0; }
    .footer { margin-top: 24px; font-size: 12px; color:#6b7280; }
  </style>
</head>
<body>
  <h1>ðŸ“¡ Whatspy Dashboard</h1>

  <div class="grid">
    <div class="card">
      <h3>ðŸ”§ Configuration</h3>
      <div class="kv">
        <p><b>Phone ID:</b> <code>{{ phone_id }}</code></p>
        <p><b>Webhook:</b> <code>{{ webhook }}</code></p>
        <p><b>Verify Token:</b> <code>{{ verify_token }}</code></p>
        <p><b>Buffer Size:</b> <code>{{ buffer_size }}</code></p>
      </div>
    </div>

    <div class="card">
      <h3>ðŸ”Œ API Endpoints</h3>
      <ul>
        {% for ep in endpoints %}
          <li><code>{{ ep }}</code></li>
        {% endfor %}
      </ul>
      <p class="muted">Use <code>Authorization: Bearer &lt;token&gt;</code> at the reverse proxy if you restrict access.</p>
    </div>
  </div>

  <div class="grid" style="margin-top:16px">
    <div class="card">
      <h3>ðŸ“¨ Recent Messages</h3>
      {% if messages %}
        {% for msg in messages %}
          <div style="border-bottom:1px dashed #eee; padding:8px 0;">
            <div><b>From:</b> {{ msg.from }} {% if msg.name %}({{ msg.name }}){% endif %}</div>
            <div><b>Text:</b> {{ msg.text }}</div>
            <div class="muted">{{ msg.timestamp }}</div>
          </div>
        {% endfor %}
      {% else %}
        <p class="muted">No messages yet.</p>
      {% endif %}
    </div>

    <div class="card">
      <h3>ðŸ“Š Status Updates</h3>
      {% if statuses %}
        {% for st in statuses %}
          <div style="border-bottom:1px dashed #eee; padding:8px 0;">
            <div><b>Message ID:</b> {{ st.message_id }}</div>
            <div><b>Status:</b> {{ st.status }}</div>
            <div class="muted">{{ st.timestamp }}</div>
          </div>
        {% endfor %}
      {% else %}
        <p class="muted">No status logs yet.</p>
      {% endif %}
    </div>
  </div>

  <p class="footer">âœ… Running at this host; webhook must be reachable publicly (HTTPS) for Meta verification.</p>
</body>
</html>
